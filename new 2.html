<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>SHEMWAVE </title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #e0f7fa;
  color: #333;
  overflow-x: hidden;
}
header, footer {
  background: #005f73;
  color: white;
  padding: 1rem;
  text-align: center;
  font-weight: bold;
}
#loginForm, #dashboard {
  max-width: 960px;
  margin: auto;
  padding: 20px;
}
#loginForm {
  background: white;
  margin-top: 50px;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  animation: fadeIn 0.6s ease-out;
}
#loginForm input, #loginForm button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}
#loginBtn {
  background: #0077b6;
  color: white;
  border: none;
  cursor: pointer;
  transition: transform 0.3s ease, background 0.3s ease;
}
#loginBtn:hover {
  transform: scale(1.05);
  background: #023e8a;
}
.room-tabs {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}
.room-tab {
  padding: 8px 14px;
  background: #caf0f8;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}
.room-tab:hover {
  background: #90e0ef;
}
.room-tab.active {
  background: #0077b6;
  color: white;
  transform: scale(1.05);
}
#roomContentContainer {
  position: relative;
  background-size: cover;
  background-position: center;
  min-height: 400px;
  border-radius: 10px;
  overflow-y: auto;
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  padding: 20px;
  animation: fadeSlide 0.6s ease forwards;
}
.device-card {
  flex: 1 1 120px;
  background: rgba(255,255,255,0.85);
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}
.device-card:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 8px 20px rgba(0,180,216,0.4);
}
.device-card.active {
  background-color: #00b4d8;
  color: white;
  box-shadow: 0 0 10px #00b4d8;
}
.fan-speed-section {
  margin: 20px auto;
  text-align: center;
  animation: fadeIn 0.6s ease;
}
#allOffBtn, #logoutBtn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  color: white;
  margin: 5px;
  cursor: pointer;
  transition: transform 0.3s ease;
}
#allOffBtn { background: #d90429; }
#logoutBtn { background: #0077b6; }
#allOffBtn:hover, #logoutBtn:hover {
  transform: scale(1.1);
}
@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(20px);}
  to { opacity: 1; transform: translateY(0);}
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>
</head>
<body>

<header>SHEMWAVE</header>

<!-- Login -->
<div id="loginForm">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <button id="loginBtn">Login</button>
</div>

<!-- Dashboard -->
<div id="dashboard" style="display:none;">
  <div class="room-tabs">
    <div class="room-tab active" data-room="room1">Living Room</div>
    <div class="room-tab" data-room="room2">Bedroom</div>
    <div class="room-tab" data-room="room3">Main Room</div>
    <div class="room-tab" data-room="room4">Kitchen</div>
  </div>
  <div id="roomContentContainer"></div>

  <div class="fan-speed-section">
    <label>Fan Speed: <span id="fanSpeedValue">1</span></label><br>
    <input type="range" min="1" max="4" value="1" id="fanSpeedSlider">
  </div>

  <div style="text-align:center;">
    <button id="allOffBtn">All OFF</button>
    <button id="logoutBtn">Logout</button>
  </div>
</div>

<footer>WELCOME TO SMART HOME ENERGY MANAGEMENT</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAkjDnnO-8pLo6nluPc0YfqVFke-EFOxNs",
  authDomain: "shemwave-sample.firebaseapp.com",
  databaseURL: "https://shemwave-sample-default-rtdb.firebaseio.com",
  projectId: "shemwave-sample",
  storageBucket: "shemwave-sample.firebasestorage.app",
  messagingSenderId: "538284696022",
  appId: "1:538284696022:web:45ba3733e8a831165b0477"
};
firebase.initializeApp(firebaseConfig);

const allowedEmail = "abc@gmail.com";
const allowedPassword = "60006000";
const loginForm = document.getElementById("loginForm");
const dashboard = document.getElementById("dashboard");

document.getElementById("loginBtn").onclick = () => {
  const email = document.getElementById("email").value.trim();
  const pass = document.getElementById("password").value;
  if (email===allowedEmail && pass===allowedPassword) {
    firebase.auth().signInWithEmailAndPassword(email, pass)
      .then(() => {
        loginForm.style.display = "none";
        dashboard.style.display = "block";
        setupRoom("room1");
      })
      .catch(e => alert("Login error: " + e.message));
  } else {
    alert("Invalid email or password.");
  }
};

const roomImages = {
  room1: 'images/IMG_7823.jpeg',
  room2: 'images/IMG_7809.jpeg',
  room3: 'images/IMG_7818.jpeg',
  room4: 'images/IMG_7822.jpeg'
};
const roomDevices = {
  room1: ["Bed Light","Main Light","Panel Light","Light 4","Light 5","Light 6","Fan"],
  room2: ["Light 1","Light 2","Light 3","Light 4","Light 5","Light 6","Fan"],
  room3: ["Light 1","Light 2","Light 3","Light 4","Light 5","Light 6","Fan"],
  room4: ["Light 1","Light 2","Light 3","Light 4","Light 5","Light 6","Fan"]
};

let relayRefs = [];
let fanSpeedRef = null;
let currentRoom = "room1";

function clearListeners() {
  relayRefs.forEach(r => r.off());
  relayRefs = [];
  if (fanSpeedRef) fanSpeedRef.off();
}

function setupRoom(room) {
  clearListeners();
  currentRoom = room;
  const container = document.getElementById("roomContentContainer");
  container.style.backgroundImage = `url('${roomImages[room]}')`;
  container.innerHTML = "";

  roomDevices[room].forEach((name,i) => {
    const id = i < 6 ? `L${i+1}` : "FAN";
    const card = document.createElement("div");
    card.className = "device-card";
    card.innerHTML = `<i class="${id==="FAN"?"fas fa-fan":"fas fa-lightbulb"} fa-2x"></i><br>${name}<div id="status-${id}">...</div>`;
    container.appendChild(card);

    const ref = firebase.database().ref(`/${room}/${id}`);
    relayRefs.push(ref);
    ref.on("value", snap => {
      const val = snap.val() ?? false;
      document.getElementById(`status-${id}`).innerText = val ? "ON" : "OFF";
      card.classList.toggle("active", val);
    });
    card.onclick = () => ref.get().then(snap => ref.set(!snap.val()));
  });

  fanSpeedRef = firebase.database().ref(`/${room}/FANSpeed`);
  fanSpeedRef.on("value", snap => {
    const val = snap.val() || 1;
    document.getElementById("fanSpeedSlider").value = val;
    document.getElementById("fanSpeedValue").innerText = val;
  });
}

document.getElementById("fanSpeedSlider").oninput = function() {
  document.getElementById("fanSpeedValue").innerText = this.value;
  if (fanSpeedRef) fanSpeedRef.set(Number(this.value));
};

document.querySelectorAll(".room-tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".room-tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    setupRoom(tab.dataset.room);
  };
});

document.getElementById("allOffBtn").onclick = () => {
  roomDevices[currentRoom].forEach((_,i) => {
    const id = i < 6 ? `L${i+1}` : "FAN";
    firebase.database().ref(`/${currentRoom}/${id}`).set(false);
  });
  if (fanSpeedRef) fanSpeedRef.set(1);
};

document.getElementById("logoutBtn").onclick = () => {
  firebase.auth().signOut().then(() => {
    dashboard.style.display = "none";
    loginForm.style.display = "block";
    clearListeners();
  });
};
</script>
</body>
</html>
