<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaTech | SHEMWAVE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #2c7da0;
            --secondary: #468faf;
            --accent: #61a5c2;
            --light: #a9d6e5;
            --dark: #012a4a;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #f5f5f5;
            --text: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }

        .logo {
            margin-bottom: 30px;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 125, 160, 0.2);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .nav-tab {
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            transition: all 0.3s;
            border-left: 5px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Temperature Card */
        .temperature-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .temperature-card::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
        }

        .temperature-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-align: center;
        }

        /* Appliance Cards */
        .appliances-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .appliance-card {
            position: relative;
            overflow: hidden;
        }

        .appliance-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger);
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background: var(--success);
        }

        .working-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            background: var(--warning);
            color: white;
        }

        .working-status.working {
            background: var(--success);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* Add Appliance Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 125, 160, 0.2);
        }

        /* Schedule List */
        .schedule-list {
            list-style: none;
        }

        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
        }

        .schedule-item:hover {
            background: #f9f9f9;
        }

        .schedule-info {
            display: flex;
            flex-direction: column;
        }

        .schedule-time {
            font-weight: 600;
            color: var(--dark);
        }

        .schedule-action {
            color: var(--text);
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: shake 0.5s ease-in-out;
            background: var(--danger);
            color: white;
        }

        .alert i {
            font-size: 1.5rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .appliances-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="login-page">
        <div class="login-box">
            <div class="logo">
                <i class="fas fa-water"></i>
                <h1>AquaTech</h1>
            </div>
            <p style="margin-bottom: 30px; color: #666;">SHEMWAVE - Smart Aqua Farming Automation</p>
            
            <div class="input-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Enter your email">
            </div>
            
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            
            <button class="btn btn-primary" id="login-btn">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            
            <p style="margin-top: 20px; color: #666;">Don't have an account? <a href="#" style="color: var(--primary);">Sign up</a></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard container" id="dashboard">
        <div class="header">
            <h1><i class="fas fa-water"></i> AquaTech Dashboard</h1>
            <div>
                <span id="user-email" style="margin-right: 15px; font-weight: 500;"></span>
                <button class="btn" style="background: var(--light);">
                    <i class="fas fa-user"></i> Profile
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="dashboard-tab">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="nav-tab" data-tab="appliances-tab">
                <i class="fas fa-plug"></i> Aqua Appliances
            </div>
            <div class="nav-tab" data-tab="schedule-tab">
                <i class="fas fa-clock"></i> Schedule
            </div>
            <div class="nav-tab" data-tab="profile-tab">
                <i class="fas fa-user"></i> Profile
            </div>
        </div>

        <!-- Alert for Motor Issue -->
        <div class="alert" id="motor-alert" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <strong>Motor Alert!</strong> The motor is ON but not working properly. Please check immediately.
            </div>
            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; margin-left: auto;" id="mute-alert-btn">
                <i class="fas fa-volume-mute"></i> Mute
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="card temperature-card floating-animation">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-thermometer-half"></i> Water Temperature</h2>
                </div>
                <div class="temperature-value">24.5Â°C</div>
                <p style="text-align: center;">Optimal for fish farming</p>
            </div>

            <h2 style="margin: 30px 0 20px; color: var(--dark);">Aqua Appliances</h2>
            
            <div class="appliances-grid" id="appliances-list">
                <!-- Appliances will be dynamically added here -->
            </div>
        </div>

        <!-- Appliances Tab -->
        <div class="tab-content" id="appliances-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-plus"></i> Add New Appliance</h2>
                </div>
                
                <div class="form-group">
                    <label for="appliance-name">Appliance Name</label>
                    <input type="text" id="appliance-name" class="form-control" placeholder="e.g., Water Pump, Light 2">
                </div>
                
                <div class="form-group">
                    <label for="appliance-type">Appliance Type</label>
                    <select id="appliance-type" class="form-control">
                        <option value="light">Light</option>
                        <option value="motor">Motor</option>
                        <option value="pump">Water Pump</option>
                        <option value="aerator">Aerator</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="add-appliance-btn">
                    <i class="fas fa-plus"></i> Add Appliance
                </button>
            </div>
            
            <h2 style="margin: 30px 0 20px; color: var(--dark);">My Appliances</h2>
            
            <div class="appliances-grid" id="my-appliances-list">
                <!-- User appliances will be dynamically added here -->
            </div>
        </div>

        <!-- Schedule Tab -->
        <div class="tab-content" id="schedule-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-plus"></i> Add New Schedule</h2>
                </div>
                
                <div class="form-group">
                    <label for="schedule-appliance">Select Appliance</label>
                    <select id="schedule-appliance" class="form-control">
                        <option value="L1">Light 1</option>
                        <option value="M1">Motor 1</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="schedule-time">Time</label>
                    <input type="time" id="schedule-time" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="schedule-action">Action</label>
                    <select id="schedule-action" class="form-control">
                        <option value="on">Turn ON</option>
                        <option value="off">Turn OFF</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="schedule-days">Repeat on Days</label>
                    <div id="schedule-days" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <label><input type="checkbox" value="0"> Sun</label>
                        <label><input type="checkbox" value="1"> Mon</label>
                        <label><input type="checkbox" value="2"> Tue</label>
                        <label><input type="checkbox" value="3"> Wed</label>
                        <label><input type="checkbox" value="4"> Thu</label>
                        <label><input type="checkbox" value="5"> Fri</label>
                        <label><input type="checkbox" value="6"> Sat</label>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="add-schedule-btn">
                    <i class="fas fa-plus"></i> Add Schedule
                </button>
            </div>
            
            <h2 style="margin: 30px 0 20px; color: var(--dark);">Scheduled Tasks</h2>
            
            <div class="card">
                <ul class="schedule-list" id="schedule-list">
                    <!-- Schedules will be dynamically added here -->
                </ul>
            </div>
        </div>

        <!-- Profile Tab -->
        <div class="tab-content" id="profile-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-user"></i> User Profile</h2>
                </div>
                
                <div class="form-group">
                    <label>Email</label>
                    <p id="profile-email" style="padding: 10px; background: var(--gray); border-radius: 5px;"></p>
                </div>
                
                <div class="form-group">
                    <label>User ID</label>
                    <p id="profile-userid" style="padding: 10px; background: var(--gray); border-radius: 5px;"></p>
                </div>
                
                <div class="form-group">
                    <label>Farm Name</label>
                    <p id="profile-farm" style="padding: 10px; background: var(--gray); border-radius: 5px;"></p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-exclamation-circle"></i> Report a Problem</h2>
                </div>
                
                <div class="form-group">
                    <label for="problem-subject">Subject</label>
                    <input type="text" id="problem-subject" class="form-control" placeholder="Brief description of the issue">
                </div>
                
                <div class="form-group">
                    <label for="problem-description">Description</label>
                    <textarea id="problem-description" class="form-control" rows="5" placeholder="Detailed description of the problem"></textarea>
                </div>
                
                <button class="btn btn-primary" id="report-problem-btn">
                    <i class="fas fa-paper-plane"></i> Send Report
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAkjDnnO-8pLo6nluPc0YfqVFke-EFOxNs",
            authDomain: "shemwave-sample.firebaseapp.com",
            databaseURL: "https://shemwave-sample-default-rtdb.firebaseio.com",
            projectId: "shemwave-sample",
            storageBucket: "shemwave-sample.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('login-btn');
        const userEmail = document.getElementById('user-email');
        const profileEmail = document.getElementById('profile-email');
        const profileUserid = document.getElementById('profile-userid');
        const profileFarm = document.getElementById('profile-farm');
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const appliancesList = document.getElementById('appliances-list');
        const myAppliancesList = document.getElementById('my-appliances-list');
        const addApplianceBtn = document.getElementById('add-appliance-btn');
        const addScheduleBtn = document.getElementById('add-schedule-btn');
        const scheduleList = document.getElementById('schedule-list');
        const reportProblemBtn = document.getElementById('report-problem-btn');
        const motorAlert = document.getElementById('motor-alert');
        const muteAlertBtn = document.getElementById('mute-alert-btn');

        // Global variables
        let currentUser = null;
        let userAppliances = {};
        let motorWorkingStatus = true;
        let schedules = [];
        let isAlertMuted = false;
        let audioContext = null;
        let oscillator = null;

        // Login function
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                // For demo purposes, we'll simulate login
                // In a real app, you would use Firebase authentication
                currentUser = { email: email };
                showDashboard();
            } else {
                alert('Please enter both email and password');
            }
        });

        // Show dashboard after login
        function showDashboard() {
            loginPage.style.display = 'none';
            dashboard.style.display = 'block';
            
            // Extract username from email
            const username = currentUser.email.split('@')[0];
            userEmail.textContent = currentUser.email;
            profileEmail.textContent = currentUser.email;
            profileUserid.textContent = username;
            profileFarm.textContent = username.charAt(0).toUpperCase() + username.slice(1) + ' Farm';
            
            // Initialize Firebase listeners
            initializeFirebaseListeners(username);
            
            // Load initial data
            loadAppliances(username);
            loadSchedules();
            
            // Start schedule checker
            setInterval(checkSchedules, 60000); // Check every minute
        }

        // Initialize Firebase realtime listeners
        function initializeFirebaseListeners(username) {
            const userRef = database.ref(username);
            
            // Listen for appliance status changes
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateApplianceStatus(data);
                    
                    // Check for motor alert condition
                    if (data.M1 === true && data.Working === false) {
                        showMotorAlert();
                    } else {
                        hideMotorAlert();
                    }
                }
            });
        }

        // Update appliance status on the dashboard
        function updateApplianceStatus(data) {
            // Update L1 status
            const l1Status = document.querySelector('.appliance-card[data-appliance="L1"] .status-indicator');
            const l1Toggle = document.querySelector('.appliance-card[data-appliance="L1"] input');
            if (l1Status && data.L1 !== undefined) {
                l1Status.classList.toggle('online', data.L1);
                if (l1Toggle) l1Toggle.checked = data.L1;
            }
            
            // Update M1 status
            const m1Status = document.querySelector('.appliance-card[data-appliance="M1"] .status-indicator');
            const m1Toggle = document.querySelector('.appliance-card[data-appliance="M1"] input');
            const workingStatus = document.querySelector('.appliance-card[data-appliance="M1"] .working-status');
            if (m1Status && data.M1 !== undefined) {
                m1Status.classList.toggle('online', data.M1);
                if (m1Toggle) m1Toggle.checked = data.M1;
                
                if (workingStatus && data.Working !== undefined) {
                    workingStatus.textContent = data.Working ? 'WORKING' : 'NOT WORKING';
                    workingStatus.classList.toggle('working', data.Working);
                    motorWorkingStatus = data.Working;
                }
            }
        }

        // Show motor alert
        function showMotorAlert() {
            if (isAlertMuted) return;
            
            motorAlert.style.display = 'flex';
            playAlertSound();
        }

        // Hide motor alert
        function hideMotorAlert() {
            motorAlert.style.display = 'none';
            stopAlertSound();
        }

        // Play alert sound using Web Audio API
        function playAlertSound() {
            try {
                // Create audio context if it doesn't exist
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Create oscillator if it doesn't exist
                if (!oscillator) {
                    oscillator = audioContext.createOscillator();
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // 800 Hz
                    
                    // Create gain node to control volume
                    const gainNode = audioContext.createGain();
                    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime); // 50% volume
                    
                    // Connect oscillator to gain node and gain node to destination
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // Start oscillator
                    oscillator.start();
                }
            } catch (e) {
                console.error('Error playing alert sound:', e);
            }
        }

        // Stop alert sound
        function stopAlertSound() {
            if (oscillator) {
                oscillator.stop();
                oscillator = null;
            }
        }

        // Mute alert button handler
        muteAlertBtn.addEventListener('click', () => {
            isAlertMuted = true;
            hideMotorAlert();
        });

        // Load appliances for the user
        function loadAppliances(username) {
            // For demo purposes, we'll add some default appliances
            const defaultAppliances = {
                'L1': { name: 'Light 1', type: 'light', status: false },
                'M1': { name: 'Motor 1', type: 'motor', status: false, working: true }
            };
            
            // Add default appliances to dashboard
            for (const [id, appliance] of Object.entries(defaultAppliances)) {
                addApplianceToDashboard(id, appliance);
                addApplianceToMyList(id, appliance);
            }
            
            // In a real app, we would fetch from Firebase
            // database.ref(username + '/appliances').on('value', (snapshot) => { ... });
        }

        // Add appliance to dashboard
        function addApplianceToDashboard(id, appliance) {
            const applianceCard = document.createElement('div');
            applianceCard.className = 'card appliance-card';
            applianceCard.setAttribute('data-appliance', id);
            
            const workingStatus = appliance.type === 'motor' ? 
                `<div class="working-status ${appliance.working ? 'working' : ''}">${appliance.working ? 'WORKING' : 'NOT WORKING'}</div>` : '';
            
            applianceCard.innerHTML = `
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-${getApplianceIcon(appliance.type)}"></i> ${appliance.name}</h2>
                </div>
                <p>Status: <span class="appliance-status-text">${appliance.status ? 'ON' : 'OFF'}</span></p>
                <div class="appliance-status">
                    <div class="status-indicator ${appliance.status ? 'online' : ''}"></div>
                    <label class="toggle-switch">
                        <input type="checkbox" ${appliance.status ? 'checked' : ''}>
                        <span class="slider"></span>
                    </label>
                </div>
                ${workingStatus}
            `;
            
            // Add event listener to toggle switch
            const toggle = applianceCard.querySelector('input');
            toggle.addEventListener('change', () => {
                updateApplianceStatusInFirebase(id, toggle.checked);
            });
            
            appliancesList.appendChild(applianceCard);
        }

        // Add appliance to "My Appliances" list
        function addApplianceToMyList(id, appliance) {
            const applianceCard = document.createElement('div');
            applianceCard.className = 'card appliance-card';
            applianceCard.setAttribute('data-appliance', id);
            
            applianceCard.innerHTML = `
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-${getApplianceIcon(appliance.type)}"></i> ${appliance.name}</h2>
                </div>
                <p>Type: ${appliance.type}</p>
                <p>ID: ${id}</p>
                <div class="appliance-status">
                    <div class="status-indicator ${appliance.status ? 'online' : ''}"></div>
                    <label class="toggle-switch">
                        <input type="checkbox" ${appliance.status ? 'checked' : ''}>
                        <span class="slider"></span>
                    </label>
                </div>
            `;
            
            // Add event listener to toggle switch
            const toggle = applianceCard.querySelector('input');
            toggle.addEventListener('change', () => {
                updateApplianceStatusInFirebase(id, toggle.checked);
            });
            
            myAppliancesList.appendChild(applianceCard);
        }

        // Get icon for appliance type
        function getApplianceIcon(type) {
            switch(type) {
                case 'light': return 'lightbulb';
                case 'motor': return 'cog';
                case 'pump': return 'tint';
                case 'aerator': return 'wind';
                default: return 'plug';
            }
        }

        // Update appliance status in Firebase
        function updateApplianceStatusInFirebase(applianceId, status) {
            const username = currentUser.email.split('@')[0];
            database.ref(username + '/' + applianceId).set(status)
                .then(() => {
                    console.log(`Appliance ${applianceId} status updated to ${status}`);
                })
                .catch((error) => {
                    console.error('Error updating appliance status:', error);
                });
        }

        // Add new appliance
        addApplianceBtn.addEventListener('click', () => {
            const name = document.getElementById('appliance-name').value;
            const type = document.getElementById('appliance-type').value;
            
            if (name) {
                // Generate a unique ID for the appliance
                const id = type.charAt(0).toUpperCase() + (Object.keys(userAppliances).length + 1);
                
                // Create appliance object
                const appliance = {
                    name: name,
                    type: type,
                    status: false
                };
                
                // Add to user's appliances
                userAppliances[id] = appliance;
                
                // Add to UI
                addApplianceToMyList(id, appliance);
                
                // In a real app, we would save to Firebase
                // database.ref(currentUser.email.split('@')[0] + '/appliances/' + id).set(appliance);
                
                // Clear form
                document.getElementById('appliance-name').value = '';
                
                alert('Appliance added successfully!');
            } else {
                alert('Please enter an appliance name');
            }
        });

        // Load schedules from Firebase (or initialize with demo data)
        function loadSchedules() {
            // For demo purposes, we'll create some sample schedules
            const sampleSchedules = [
                { id: 1, appliance: 'L1', time: '18:00', action: 'on', days: [0,1,2,3,4,5,6] },
                { id: 2, appliance: 'L1', time: '06:00', action: 'off', days: [0,1,2,3,4,5,6] },
                { id: 3, appliance: 'M1', time: '08:00', action: 'on', days: [1,2,3,4,5] }
            ];
            
            schedules = sampleSchedules;
            
            // Render schedules
            renderSchedules();
        }

        // Render schedules to the UI
        function renderSchedules() {
            scheduleList.innerHTML = '';
            
            schedules.forEach(schedule => {
                const scheduleItem = document.createElement('li');
                scheduleItem.className = 'schedule-item';
                scheduleItem.setAttribute('data-schedule-id', schedule.id);
                
                // Format days
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const activeDays = schedule.days.map(day => dayNames[day]).join(', ');
                
                scheduleItem.innerHTML = `
                    <div class="schedule-info">
                        <span class="schedule-time">${schedule.time}</span>
                        <span class="schedule-action">${schedule.appliance} - Turn ${schedule.action.toUpperCase()}</span>
                        <span class="schedule-days" style="font-size: 0.8rem; color: #666;">${activeDays}</span>
                    </div>
                    <button class="btn delete-schedule" style="background: var(--light);">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // Add delete functionality
                const deleteBtn = scheduleItem.querySelector('.delete-schedule');
                deleteBtn.addEventListener('click', () => {
                    deleteSchedule(schedule.id);
                });
                
                scheduleList.appendChild(scheduleItem);
            });
        }

        // Delete a schedule
        function deleteSchedule(scheduleId) {
            schedules = schedules.filter(schedule => schedule.id !== scheduleId);
            renderSchedules();
        }

        // Add new schedule
        addScheduleBtn.addEventListener('click', () => {
            const appliance = document.getElementById('schedule-appliance').value;
            const time = document.getElementById('schedule-time').value;
            const action = document.getElementById('schedule-action').value;
            
            // Get selected days
            const dayCheckboxes = document.querySelectorAll('#schedule-days input[type="checkbox"]:checked');
            const days = Array.from(dayCheckboxes).map(cb => parseInt(cb.value));
            
            if (time && days.length > 0) {
                // Create new schedule
                const newSchedule = {
                    id: Date.now(), // Simple ID generation
                    appliance: appliance,
                    time: time,
                    action: action,
                    days: days
                };
                
                // Add to schedules
                schedules.push(newSchedule);
                
                // In a real app, we would save to Firebase
                // database.ref(currentUser.email.split('@')[0] + '/schedules/' + newSchedule.id).set(newSchedule);
                
                // Re-render schedules
                renderSchedules();
                
                // Clear form
                document.getElementById('schedule-time').value = '';
                document.querySelectorAll('#schedule-days input[type="checkbox"]').forEach(cb => cb.checked = false);
                
                alert('Schedule added successfully!');
            } else {
                alert('Please select a time and at least one day');
            }
        });

        // Check schedules and trigger actions
        function checkSchedules() {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            schedules.forEach(schedule => {
                // Check if schedule matches current time and day
                if (schedule.time === currentTime && schedule.days.includes(currentDay)) {
                    // Execute the scheduled action
                    updateApplianceStatusInFirebase(schedule.appliance, schedule.action === 'on');
                    
                    // Show notification
                    showScheduleNotification(schedule);
                }
            });
        }

        // Show notification for scheduled action
        function showScheduleNotification(schedule) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'alert';
            notification.style.background = 'var(--success)';
            notification.innerHTML = `
                <i class="fas fa-clock"></i>
                <div>
                    <strong>Scheduled Action Executed</strong><br>
                    ${schedule.appliance} turned ${schedule.action.toUpperCase()} as scheduled
                </div>
            `;
            
            // Insert before the first tab content
            document.querySelector('.tab-content').parentNode.insertBefore(notification, document.querySelector('.tab-content'));
            
            // Remove notification after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Report problem
        reportProblemBtn.addEventListener('click', () => {
            const subject = document.getElementById('problem-subject').value;
            const description = document.getElementById('problem-description').value;
            
            if (subject && description) {
                // In a real app, we would send this to a server or use a mailto link
                const mailtoLink = `mailto:shemwave@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(description)}`;
                window.location.href = mailtoLink;
                
                // Clear form
                document.getElementById('problem-subject').value = '';
                document.getElementById('problem-description').value = '';
                
                alert('Problem report sent!');
            } else {
                alert('Please fill in both subject and description');
            }
        });

        // Tab navigation
        navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                navTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // Demo login for testing (remove in production)
        document.getElementById('email').value = 'aqua1@gmail.com';
        document.getElementById('password').value = 'demo123';
    </script>
</body>
</html>